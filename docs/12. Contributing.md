# Contributing



## Table of Contents
1. [Development Environment Setup](#development-environment-setup)
2. [Codebase Conventions](#codebase-conventions)
3. [Branching Strategy and Workflow](#branching-strategy-and-workflow)
4. [Building and Testing](#building-and-testing)
5. [Issue Tracking and Feature Requests](#issue-tracking-and-feature-requests)
6. [Code Review and Documentation](#code-review-and-documentation)

## Development Environment Setup

To contribute to the exim-pilot project, you must set up a development environment that supports both Go (backend) and TypeScript/React (frontend) development. The project uses modern tooling for automation, hot reloading, and testing.

### Required Tools
- **Go 1.23.4+**: The backend is written in Go. Install from [golang.org](https://golang.org/dl/).
- **Node.js 18+ and npm**: The frontend is built with React and TypeScript. Install from [nodejs.org](https://nodejs.org/).
- **Air**: For Go hot reloading during development. Install via:
  
```bash
  go install github.com/cosmtrek/air@latest
  ```

- **Vite**: Frontend development server and build tool (installed automatically via npm).
- **Playwright**: For end-to-end browser testing (configured in project).

### Initial Setup
1. Clone the repository:
   
```bash
   git clone https://github.com/andreitelteu/exim-pilot.git
   cd exim-pilot
   ```


2. Install Go dependencies:
   
```bash
   ./make install
   ```


3. Install frontend dependencies:
   
```bash
   cd web && npm install && cd ..
   ```


4. Copy the example configuration:
   
```bash
   cp config/config.example.yaml config/local.yaml
   ```

   Modify `config/local.yaml` as needed for your environment.

5. Start both backend and frontend in development mode:
   
```bash
   ./make dev        # Starts Go backend with hot reload
   npm run dev       # From web/ directory: starts Vite frontend
   ```


The backend runs on `http://localhost:8080`, and the frontend on `http://localhost:3000`. The Vite development server proxies API requests to the Go backend.

**Section sources**
- [go.mod](file://go.mod#L1-L18)
- [make](file://make#L0-L160)
- [package.json](file://web/package.json#L0-L45)
- [vite.config.ts](file://web/vite.config.ts#L0-L61)
- [config.example.yaml](file://config/config.example.yaml)

## Codebase Conventions

The exim-pilot project follows consistent coding standards for both Go and TypeScript to ensure readability, maintainability, and type safety.

### Go Conventions
- **Formatting**: All Go code must be formatted using `gofmt`. No additional styling tools are used.
- **Naming**: Use clear, descriptive names. Exported functions and types use PascalCase; internal ones use camelCase.
- **Error Handling**: Always check and handle errors explicitly. Avoid panic in production code.
- **Comments**: Use Go doc comments for exported functions and types. Internal logic should be self-documenting or briefly commented.

Example from `cmd/exim-pilot/main.go`:

```go
// Starts the HTTP server and blocks until shutdown.
// Reads configuration from the default path.
func main() {
    // Implementation
}
```


### TypeScript/React Conventions
- **TypeScript**: Strict mode is enabled (`"strict": true` in `tsconfig.json`). All variables and function parameters must be typed.
- **React**: Functional components with hooks. No class components.
- **File Structure**: Components are organized in `web/src/components/FeatureName/`. Each component has its own directory with `.tsx` and optional test files.
- **Styling**: Tailwind CSS is used for utility-first styling. Custom CSS is limited to `App.css`.
- **Imports**: Uses path alias `@` for `src/` directory (configured in `vite.config.ts`).

Example import using alias:

```typescript
import { useLogs } from '@/hooks/useLogs';
import Layout from '@/components/Common/Layout';
```


### Linting and Formatting
- **Go**: No separate linter; relies on `gofmt` and compiler checks.
- **TypeScript**: ESLint with `typescript-eslint` and React plugins. Run with:
  
```bash
  npm run lint
  ```

  Configuration is in `eslint.config.js`.

**Section sources**
- [web/package.json](file://web/package.json#L0-L45)
- [web/vite.config.ts](file://web/vite.config.ts#L0-L61)
- [web/eslint.config.js](file://web/eslint.config.js)

## Branching Strategy and Workflow

The project follows a simplified Git workflow based on feature branches and pull requests.

### Branching Model
- **Main Branch**: `main` is the default branch and represents the latest stable state.
- **Feature Branches**: All new work is done in feature branches named `feature/descriptive-name`.
- **Bugfix Branches**: Named `fix/issue-description`.
- **Release Branches**: Not currently used; deployments are built directly from `main`.

### Commit Message Conventions
Use conventional commit style to improve changelog generation:
- `feat: add new message trace viewer`
- `fix: resolve queue refresh race condition`
- `docs: update contributing guide`
- `refactor: simplify log parser interface`
- `test: add e2e test for login flow`
- `chore: update dependencies`

Each commit should be atomic and represent a single logical change.

### Pull Request Workflow
1. Create a feature branch from `main`:
   
```bash
   git checkout -b feature/realtime-log-tail
   ```


2. Commit your changes with descriptive messages.

3. Push to your fork:
   
```bash
   git push origin feature/realtime-log-tail
   ```


4. Open a Pull Request (PR) on GitHub:
   - Target the `main` branch.
   - Include a clear title and description.
   - Reference any related issues (e.g., `Closes #12`).
   - Attach screenshots for UI changes.

5. Wait for CI checks to pass and request a review.

6. Address feedback, push additional commits, and await final approval.

7. PR is merged by a maintainer.

**Section sources**
- [README.md](file://README.md#L0-L69)

## Building and Testing

The project uses a unified `make` script for all build and test operations.

### Build Commands
| Command | Description |
|--------|-------------|
| `./make install` | Install Go dependencies |
| `./make dev` | Start backend with hot reload |
| `./make build-dev` | Build development binary |
| `./make build` | Build production binary with embedded frontend |
| `./make build-all` | Build all binaries (main + config tool) |
| `./make clean` | Remove build artifacts |

The production build embeds the compiled frontend (`web/dist/`) into the Go binary using Go embed and the `embed` build tag.

### Running Tests
The test suite includes unit, integration, and end-to-end tests.

- **Go Tests**: Run all Go tests:
  
```bash
  go test ./...
  ```


  Specific test files (e.g., `internal/database/connection_test.go`) can be run individually.

- **Frontend Unit Tests**: Not currently implemented.

- **End-to-End Tests**: Use Playwright for browser automation.
  
```bash
  npx playwright test
  ```


  Test files are located in `tests/frontend/` and use `.spec.ts` extension. Configuration is in `tests/playwright.config.ts`.

- **Integration Tests**: Located in `tests/integration/api_test.go`, testing HTTP endpoints.

To run all tests:

```bash
./make test
```


### Test Structure
- `tests/frontend/`: Playwright tests for UI flows (login, queue, logs).
- `tests/integration/`: Go-based API integration tests.
- `tests/performance/`: Performance benchmarks.
- `tests/setup/`: Global setup and teardown scripts for testing.

**Section sources**
- [make](file://make#L0-L160)
- [tests/playwright.config.ts](file://tests/playwright.config.ts)
- [tests/integration/api_test.go](file://tests/integration/api_test.go)

## Issue Tracking and Feature Requests

All issue tracking and feature planning is managed via GitHub Issues and Discussions.

### Reporting Bugs
When reporting a bug:
1. Search existing issues to avoid duplicates.
2. Provide:
   - Clear title
   - Steps to reproduce
   - Expected vs. actual behavior
   - Screenshots or logs if applicable
   - Environment details (OS, Go/Node versions)

### Requesting Features
Feature requests should:
- Describe the use case and benefit
- Reference relevant sections of `features.md`
- Suggest UI/UX if applicable
- Be broken into small, actionable items

The `features.md` file outlines planned functionality including:
- Mail queue management (view, search, bulk actions)
- Log analysis and real-time tailing
- Message tracing and delivery history
- Deliverability reporting
- Audit logging

### Feature Implementation Process
1. Discuss the feature in GitHub Discussions or Issues.
2. Get approval from maintainers.
3. Create a task list if needed.
4. Implement in a feature branch.
5. Submit PR with tests and documentation.

**Section sources**
- [features.md](file://features.md#L0-L119)
- [README.md](file://README.md#L0-L69)

## Code Review and Documentation

### Code Review Expectations
All pull requests require at least one approval before merging. Reviewers evaluate:
- **Correctness**: Does it solve the problem without introducing bugs?
- **Style**: Does it follow Go and TypeScript conventions?
- **Tests**: Are new features covered by tests?
- **Performance**: Are there any inefficiencies?
- **Security**: Are inputs validated? Are there potential vulnerabilities?
- **Documentation**: Are changes documented?

Maintainers may request revisions. Be responsive and open to feedback.

### Documentation Updates
When contributing:
- Update `README.md` for new features or configuration changes.
- Add comments to complex logic.
- Update `features.md` if implementing a new capability.
- Write clear commit messages and PR descriptions.

The project values clarity and maintainability. Even small contributions help improve the system.

Welcome to the exim-pilot community!

**Section sources**
- [README.md](file://README.md#L0-L69)
- [features.md](file://features.md#L0-L119)

**Referenced Files in This Document**   
- [main.go](file://cmd/exim-pilot/main.go)
- [go.mod](file://go.mod)
- [make](file://make)
- [package.json](file://web/package.json)
- [vite.config.ts](file://web/vite.config.ts)
- [config.example.yaml](file://config/config.example.yaml)
- [air.toml](file://.air.toml)
- [playwright.config.ts](file://tests/playwright.config.ts)